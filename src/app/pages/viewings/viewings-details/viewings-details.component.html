<div id="splash-screen" class="splash-screen" *ngIf="IsLoading">
  <img src="./assets/media/logos/prophero-small.svg" alt="PropHero logo" />
  <span>Loading ...</span>
</div>
<div id="kt_viewing-details" class="bg-body" data-kt-drawer="true" data-kt-drawer-name="viewing-details"
  data-kt-drawer-activate="true" data-kt-drawer-overlay="false" data-kt-drawer-width="{default:'300px', 'lg': '900px'}"
  data-kt-drawer-direction="end" data-kt-drawer-toggle=".kt_viewing-details_toggle"
  data-kt-drawer-close="#kt_viewing-details_close" #container>
  <div class="card shadow-none rounded-0 w-100">
    <form>
    <div class="card-header" id="kt_viewing-details_header">
      <div>
        <div class="card-title fw-bold text-dark">
          <span *ngIf="isAdd">New Viewing</span>
          <span *ngIf="!isAdd && viewingDetails !== null">{{viewingDetails?.reference}}</span>
          <div class="ms-2" *ngIf="!isAdd">
            <!--begin::Dropview toggle-->
            <a
              class="btn btn-icon btn-sm"
              data-kt-menu-trigger="{default: 'click', lg: 'hover'}"
              data-kt-menu-attach="parent"
              data-kt-menu-placement="bottom-start"
            >
              <i class="bi bi-clock fs-3"></i>
            </a>
            <!--end::Dropview toggle-->

            <!--begin::Dropview-->
            <div
              class="menu menu-sub menu-sub-dropdown p-4"
              data-kt-menu="true"
            >
              <small>
                Created: {{ viewingDetails?.created | date : "dd/MM/yyyy hh:mm:ss a " }}<br />
                Updated: {{ viewingDetails?.updated | date : "dd/MM/yyyy hh:mm:ss a " }}<br />
               
              </small>
            </div>
            <!--end::Dropview-->
          </div>
        </div>
        <div class="card-toolbar">
          <button type="button" class="btn btn-sm btn-icon btn-active-light-primary"
            id="kt_viewing-details_close" (click)="closeViewing()">
            <app-keenicon name="cross" class="fs-1"></app-keenicon>
          </button>
        </div>
      </div>
      <div class="d-flex align-items-center">
        <ul class="nav nav-stretch nav-line-tabs nav-line-tabs-2x border-transparent fs-5 fw-bold">
            <!--begin::Nav item-->
            <li class="nav-item">
              <a
                class="nav-link text-active-primary ms-0 me-10 py-5 active cursor-pointer"
                [class.active]="selectedTab === 'tab1'"
                (click)="selectTab('tab1')"
              >
                Details
              </a>
            </li>

            
          </ul>
          <div class="d-flex align-items-center" *ngIf="selectedTab === 'tab1'">
            <button
            (click)="onCancel()"
            class="btn btn-sm btn-light btn-active-light-primary me-3"
            *ngIf="isEdit"
          >
            Cancel
          </button>
            <button *ngIf="isAdd || isEdit"
            (click)="onSubmit()"
            class="btn btn-sm btn-primary"
          >
            Save
          </button>
          <button *ngIf="isView && isEditViewingPermission"
          (click)="onEdit()"
          class="btn btn-sm btn-primary"
        >
          Edit
        </button>
          </div>
       
      </div>
    </div>
    <div class="card-body position-relative p-0" id="kt_activities_body">
      <ul class="accordian-shortcuts">
        <li id="sec_1_1">
          <button (click)="scrollToElement('sec1'); basic = true" [ngClass]="isSave && basicDetailForm.invalid  ? 'border-error' : ''">
            <i class="bi bi-house"></i>
          </button>
          <span class="reveal">Basic Details</span>
        </li>
        
      </ul>
    <div class="accordion" id="kt_accordion_1" #container>
      <form [formGroup]="basicDetailForm">
      <div class="accordion-item" id="sec1">
        <div class="accordion-body">
          <div class="row mb-6">
            <label class="col-lg-3 col-form-label fw-bold fs-6">Status</label>
            <div class="col-lg-6">
              <ng-select appendTo=".col-lg-6" formControlName="statusId" bindLabel="status" [clearable]="false" [ngClass]="basicDetailForm.get('statusId')?.value == 1? 'ph-status-dropdown text-blue':basicDetailForm.get('statusId')?.value == 2?'ph-status-dropdown text-green': basicDetailForm.get('statusId')?.value == 3?'ph-status-dropdown text-red':basicDetailForm.get('statusId')?.value == 4 ? 'ph-status-dropdown text-grey':''">
                <ng-option *ngFor="let vs of AllViewingStatus" [value]="vs.id">{{ vs.name }}</ng-option>
              </ng-select>
            </div>
          </div>

        </div>
      </div>
      <div class="accordion-item" id="sec2">
        <h2 class="accordion-header" id="kt_accordion_1_header_1">
          <button class="accordion-button fs-4 fw-semibold" type="button" (click)="basic = !basic"
            [class.collapsed]="!basic" [ngClass]="isSave && basicDetailForm.invalid ? 'border-error' : ''">
            Basic Details
          </button>
        </h2>
        <div id="kt_accordion_1_body_1" class="accordion-collapse collapse" [class.show]="basic">
          <div class="accordion-body">
            
              
              <div class="row mb-6">
                <label class="col-lg-3 col-form-label fw-bold fs-6 required">Assigned To</label>
                <div class="col-lg-6">
                  <ng-select formControlName="agentId" bindLabel="agentId"  [ngClass]="isSave && agent.invalid ? 'border-error' : ''">
                    <ng-option *ngFor="let assignee of AllViewingsPackList" [value]="assignee.id">
                      <span class="d-flex gap-2 align-items-center">
                        <ngx-avatar *ngIf="assignee.profileImage == null || assignee.profileImage == ''" size="26" class="avatar" [name]="assignee?.name"></ngx-avatar>
                        <img *ngIf="assignee.profileImage != null && assignee.profileImage != ''" [src]="assignee.profileImage" alt="Image Preview" [style.border-radius.px]="50" [style.width.px]="26" [style.height.px]="26">
                        {{ assignee.name }}</span></ng-option>
                  </ng-select>
                  <div *ngIf="isSave && agent.invalid" class="required-feedback">
                    <div class="error-text">Assigned To is required</div>
                  </div>
                </div>
              </div>
              
                <div class="row mb-6">
                    <label class="col-lg-3 col-form-label fw-bold fs-6 required">Listing</label>
                      <div class="col-lg-6">
                        <input type="hidden" formControlName="listingId">
                        <div class="m-0">
                          <button [disabled]="isView" (click)="openListingModal()" class="btn btn-bg-light btn-icon-primary btn-text-primary" [ngClass]="isSave && listingId.invalid  ? 'border-error' : ''">
                            <i class="bi bi-check2-square"></i> Select Listing
                          </button>
                        </div>
                        
                        <div *ngIf="isSave && listingId.invalid" class="required-feedback">
                          <div class="error-text">Listing is required</div>
                        </div>   

                       
                      </div>
                      
                  </div>
                  <div *ngIf="selectedListingId != 0">
                    <div class="row mb-6">
                      <label class="col-lg-3 col-form-label fw-bold fs-6">Listing Reference</label>
                      <div class="col-lg-6 d-flex align-items-center">
                        {{selectedListingRef}}
                      </div>
                    </div>

                    <div class="row mb-6">
                      <label class="col-lg-3 col-form-label fw-bold fs-6">Purpose</label>
                      <div class="col-lg-6 d-flex align-items-center">
                        {{selectedListingPurpose}}
                      </div>
                    </div>

                    <div class="row mb-6">
                      <label class="col-lg-3 col-form-label fw-bold fs-6">Property Type</label>
                      <div class="col-lg-6 d-flex align-items-center">
                        {{selectedListingpropertyType}}
                      </div>
                    </div>

                    <div class="row mb-6">
                      <label class="col-lg-3 col-form-label fw-bold fs-6">Beds</label>
                      <div class="col-lg-6 d-flex align-items-center">
                        {{selectedListingBed}}
                      </div>
                    </div>

                    <div class="row mb-6">
                      <label class="col-lg-3 col-form-label fw-bold fs-6">Emirate</label>
                      <div class="col-lg-6 d-flex align-items-center">
                        {{selectedListingEmirate}}
                      </div>
                    </div>

                    <div class="row mb-6">
                      <label class="col-lg-3 col-form-label fw-bold fs-6">Location</label>
                      <div class="col-lg-6 d-flex align-items-center">
                        {{selectedListingLocation}}
                      </div>
                    </div>

                    <div class="row mb-6">
                      <label class="col-lg-3 col-form-label fw-bold fs-6">Sub Location</label>
                      <div class="col-lg-6 d-flex align-items-center">
                        {{selectedListingSubLocation}}
                      </div>
                    </div>

                    <div class="row mb-6">
                      <label class="col-lg-3 col-form-label fw-bold fs-6">Price</label>
                      <div class="col-lg-6 d-flex align-items-center">
                        {{selectedListingPrice}}
                      </div>
                    </div>
                   
              </div>
                  <div class="row mb-6 ">
                    <label class="col-lg-3 col-form-label fw-bold fs-6 required">Lead</label>
                    <div class="col-lg-6">
                      <input type="hidden" formControlName="leadId">
                      <div class="m-0">
                        <button [disabled]="isView" (click)="openLeadModal()" class="btn btn-bg-light btn-icon-primary btn-text-primary" [ngClass]="isSave && leadId.invalid  ? 'border-error' : ''">
                          <i class="bi bi-check2-square"></i> Select Lead
                        </button>
                      </div>
                     
                      <div *ngIf="isSave && leadId.invalid" class="required-feedback">
                        <div class="error-text">Lead is required</div>
                      </div> 
                    </div>
                  </div>

                  <div *ngIf="selectedLeadId != 0">
                    <div class="row mb-6">
                      <label class="col-lg-3 col-form-label fw-bold fs-6">Lead Reference</label>
                      <div class="col-lg-6 d-flex align-items-center">
                        {{selectedLeadRef}}
                      </div>
                    </div>

                    <div class="row mb-6">
                      <label class="col-lg-3 col-form-label fw-bold fs-6">Lead First Name</label>
                      <div class="col-lg-6 d-flex align-items-center">
                        {{selectedLeadFirstName}}
                      </div>
                    </div>

                    <div class="row mb-6">
                      <label class="col-lg-3 col-form-label fw-bold fs-6">Lead Last Name</label>
                      <div class="col-lg-6 d-flex align-items-center">
                        {{selectedLeadLastName}}
                      </div>
                    </div>

                    <div class="row mb-6">
                    <carousel class="ph-carousel" id="ownerContact">
                      <slide>
                        <!-- Slide 1 content -->
                        <div class="row mb-6">
                          <label class="col-lg-3 col-form-label fw-bold fs-6">Mobile (Personal)</label>
                          <div class="col-lg-6 d-flex align-items-center">
                            {{PeronsalMobile}}
                          </div>
                        </div><!--./row-->
                        <div class="row mb-6">
                          <label class="col-lg-3 col-form-label fw-bold fs-6">Phone (Personal)</label>
                          <div class="col-lg-6 d-flex align-items-center">
                            {{PersonalPhone}}
                          </div>
                        </div><!--./row-->
                        <div class="row mb-6">
                          <label class="col-lg-3 col-form-label fw-bold fs-6">Email (Personal)</label>
                          <div class="col-lg-6 d-flex align-items-center">
                            {{PersonalEmail}}
                          </div>
                        </div>
                        <!--./row-->
                      </slide>
                      <slide>
                        <!-- Slide 2 content -->
                        <div class="row mb-6">
                          <label class="col-lg-3 col-form-label fw-bold fs-6">Mobile (Work)</label>
                          <div class="col-lg-6 d-flex align-items-center">
                            {{WorkMobile}}
                          </div>
                        </div><!--./row-->
                        <div class="row mb-6">
                          <label class="col-lg-3 col-form-label fw-bold fs-6">Phone (Work)</label>
                          <div class="col-lg-6 d-flex align-items-center">
                            {{WorkPhone}}
                          </div>
                        </div><!--./row-->
                        <div class="row mb-6">
                          <label class="col-lg-3 col-form-label fw-bold fs-6">Email (Work)</label>
                          <div class="col-lg-6 d-flex align-items-center">
                            {{WorkEmail}}
                          </div>
                        </div><!--./row-->
                      </slide>
                      <slide>
                        <!-- Slide 3 content -->
                        <div class="row mb-6">
                          <label class="col-lg-3 col-form-label fw-bold fs-6">Mobile (Other)</label>
                          <div class="col-lg-6 d-flex align-items-center">
                            {{OtherMobile}}
                          </div>
                        </div><!--./row-->
                        <div class="row mb-6">
                          <label class="col-lg-3 col-form-label fw-bold fs-6">Phone (Other)</label>
                          <div class="col-lg-6 d-flex align-items-center">
                            {{OtherPhone}}
                          </div>
                        </div><!--./row-->
                        <div class="row mb-6">
                          <label class="col-lg-3 col-form-label fw-bold fs-6">Email (Other)</label>
                          <div class="col-lg-6 d-flex align-items-center">
                            {{OtherEmail}}
                          </div>
                        </div><!--./row-->
                      </slide>
                    </carousel>
                  </div>
                   
              </div>
    
                  <div class="row mb-6">
                    <label class="col-lg-3 col-form-label fw-bold fs-6 required">Start Date</label>
                    <div class="col-lg-3">
                      
                      <input type="date" id="startDate" class="form-control form-control-lg mb-3 mb-lg-0"
                        formControlName="startDate" [ngClass]="isSave && startDate.invalid  ? 'border-error' : ''"
                        [ngClass]="{'ph-date-selected': basicDetailForm.controls['startDate'].value !== null}" />
                        <div *ngIf="isSave && startDate.invalid" class="required-feedback">
                          <div class="error-text">Start Date is required</div>
                        </div>
                    </div>
                    <div class="col-lg-3">
                      <input type="time" id="startDateTime" class="form-control form-control-lg mb-3 mb-lg-0"
                        formControlName="startDateTime" [ngClass]="isSave && startDateTime.invalid  ? 'border-error' : ''"/>
                      <!-- <ng-select formControlName="startTimeId" bindLabel="startTime">
                        <ng-option *ngFor="let t of AllViewingTimeList" [value]="t.id">{{ t.name }}</ng-option>
                      </ng-select> -->
                      <div *ngIf="isSave && startDateTime.invalid" class="required-feedback">
                        <div class="error-text">Start Time is required</div>
                      </div>
                    </div>
                  </div>
    
                  <div class="row mb-6">
                    <label class="col-lg-3 col-form-label fw-bold fs-6 required">End Date</label>
                    <div class="col-lg-3">
                      <input type="date" id="endDate" class="form-control form-control-lg mb-3 mb-lg-0"
                        formControlName="endDate" [ngClass]="isSave && endDate.invalid  ? 'border-error' : ''"
                        [ngClass]="{'ph-date-selected': basicDetailForm.controls['endDate'].value !== null}"/>
                        <div *ngIf="isSave && endDate.invalid" class="required-feedback">
                          <div class="error-text">End Date is required</div>
                        </div>
                    </div>
                    <div class="col-lg-3">
                      <input type="time" id="endDateTime" class="form-control form-control-lg mb-3 mb-lg-0"
                        formControlName="endDateTime" [ngClass]="isSave && endDateTime.invalid  ? 'border-error' : ''" />
                      <!-- <ng-select formControlName="endTimeId" bindLabel="endTime">
                        <ng-option *ngFor="let t of AllViewingTimeList" [value]="t.id">{{ t.name }}</ng-option>
                      </ng-select> -->
                      <div *ngIf="isSave && endDateTime.invalid" class="required-feedback">
                        <div class="error-text">End Time is required</div>
                      </div>
                    </div>
                  </div>
    
                 
    
                 
    
                  <!-- <div class="row mb-6">
                    <label class="col-lg-3 col-form-label fw-bold fs-6">Invite</label>
                    <div class="col-lg-6">
                      <ng-select [items]="[]" [addTag]="true" [multiple]="true" [selectOnTab]="true"
                        formControlName="invite" [isOpen]="false">
                      </ng-select>
                    </div>
                  </div> -->
    
                  <div class="row mb-6">
                    <label class="col-lg-3 col-form-label fw-bold fs-6">Notes</label>
                    <div class="col-lg-6">
                      <textarea name="" id="notes" formControlName="notes" cols="48" rows="10" class="form-control"></textarea>
                    </div>
                  </div>
            
          </div>
        </div>
      </div>
    </form>
    </div>
    </div>
  </form>
  </div>
</div>

<ng-template #ViewListing>
    <form [formGroup]="form" novalidate="" class="form">
        <div class="modal-content advance-filter-modal">
          <div class="modal-header py-3">
            <!--begin::Modal title-->
            <h4 class="m-0">Select Listing</h4>
            <!--end::Modal title-->
            <div
              class="btn btn-sm btn-icon btn-active-color-primary"
              (click)="closeViewList()"
            >
              <i class="ki-duotone ki-cross fs-1"
                ><span class="path1"></span><span class="path2"></span
              ></i>
            </div>
          </div>
          <div class="modal-body p-0">
            <div class="table-responsive">
              <!-- begin::Table -->
              <table
              id="listings_row"
              class="table table-row-dashed table-row-gray-300 align-middle gs-0 gy-4"
            >
              <!-- begin::Table head -->
              <thead class="fw-bold">
                <th class="w-40px">
                  <!-- <div
                    class="form-check form-check-sm form-check-custom form-check-solid p-0"
                  >
                    <input
                      class="form-check-input"
                      type="checkbox"
                      value="1"
                      data-kt-check="true"
                      data-kt-check-target=".widget-9-check"
                    />
                  </div> -->
                </th>

                <!--Reference & Status-->
                <th
                  class="min-w-120px"
                  (click)="
                    listingData('Ref', !form.value.sortDirection, page, itemsPerPage)
                  "
                >
                  Reference
                </th>
                <th
                  class="min-w-120px"
                  (click)="
                    listingData(
                      'Status',
                      !form.value.sortDirection,
                      page,
                      itemsPerPage
                    )
                  "
                >
                  Status
                </th>
                
                <!--BasicDetails-->
                <th
                  class="min-w-120px"
                  (click)="
                    listingData(
                      'Agent',
                      !form.value.sortDirection,
                      page,
                      itemsPerPage
                    )
                  "
                >
                  Assigned To
                </th>

                <!--Agent Email: hiding it for now -->
                
                <!--./hiding-->

                <th
                  class="min-w-120px"
                  (click)="
                    listingData(
                      'Usage',
                      !form.value.sortDirection,
                      page,
                      itemsPerPage
                    )
                  "
                >
                  Usage
                </th>
                <th
                  class="min-w-120px"
                  (click)="
                    listingData(
                      'Purpose',
                      !form.value.sortDirection,
                      page,
                      itemsPerPage
                    )
                  "
                >
                  Purpose
                </th>
                <th
                  class="min-w-120px"
                  (click)="
                    listingData(
                      'Category',
                      !form.value.sortDirection,
                      page,
                      itemsPerPage
                    )
                  "
                >
                  Property Type
                </th>
                
                <th
                  class="min-w-120px"
                  (click)="
                    listingData('Beds', !form.value.sortDirection, page, itemsPerPage)
                  "
                >
                  Beds
                </th>

                
                <th class="min-w-120px" (click)="listingData('BUA', !form.value.sortDirection, page, itemsPerPage)">Built-up Area</th>
              
                
              
              
                
              
                <!--Address-->
                <th
                  class="min-w-120px"
                  (click)="
                    listingData(
                      'Emirate',
                      !form.value.sortDirection,
                      page,
                      itemsPerPage
                    )
                  "
                >
                  Emirate
                </th>
                <th
                  class="min-w-120px"
                  (click)="
                    listingData(
                      'Location',
                      !form.value.sortDirection,
                      page,
                      itemsPerPage
                    )
                  "
                >
                  Location
                </th>
                <th
                  class="min-w-120px"
                  (click)="
                    listingData(
                      'SubLocation',
                      !form.value.sortDirection,
                      page,
                      itemsPerPage
                    )
                  "
                >
                  Sub Location
                </th>
                
                <th
                  class="min-w-120px"
                  (click)="
                    listingData('Unit', !form.value.sortDirection, page, itemsPerPage)
                  "
                >
                  Unit No.
                </th>
                

                <!--Pricing-->
              

                <th
                  class="min-w-120px"
                  (click)="
                    listingData(
                      'Price',
                      !form.value.sortDirection,
                      page,
                      itemsPerPage
                    )
                  "
                >
                  Price
                </th>
                

                
                
                
                <!--Contact Details-->
                <th
                  class="min-w-120px"
                  (click)="
                    listingData(
                      'OwnerFirstname',
                      !form.value.sortDirection,
                      page,
                      itemsPerPage
                    )
                  "
                >
                  Owner First Name
                </th>
                <th
                  class="min-w-120px"
                  (click)="
                    listingData(
                      'OwnerLastname',
                      !form.value.sortDirection,
                      page,
                      itemsPerPage
                    )
                  "
                >
                  Owner Last Name
                </th>
                
              
              </thead>
              <!-- end::Table head -->

              <!-- begin::Table Filter -->
              <thead id="filter">
                <th></th>

                <!--Reference & Status-->
                <th>
                  <input
                    placeholder="Min. 3 chars"
                    formControlName="reference"
                    class="form-control mb-3 mb-lg-0"
                    (keyup)="
                      onFilterSelection('reference', $event, page, itemsPerPage)
                    "
                  />
                </th>
                <th>
                  <ng-select
                    formControlName="status"
                    bindLabel="name"
                    (change)="
                      onFilterSelectionDrp('status', $event, page, itemsPerPage)
                    "
                  >
                    <ng-option *ngFor="let car of statusList" [value]="car.id">{{
                      car.name
                    }}</ng-option>
                  </ng-select>
                </th>
              
                <!--BasicDetails-->
                <th>
                  <!-- <input
                      formControlName="agent"
                      class="form-control mb-3 mb-lg-0"
                      (keyup)="onFilterSelection('agent', $event, page, itemsPerPage
      )"
                    /> -->
                  <ng-select
                    formControlName="assignedToId"
                    bindLabel="name"
                    (change)="
                      onFilterSelectionDrp('assignedToId', $event, page, itemsPerPage)
                    "
                  >
                    <ng-option *ngFor="let car of assignToList" [value]="car.id">{{
                      car.name
                    }}</ng-option>
                  </ng-select>
                </th>

                <!--Agent Email: hiding it for now -->
              
                <!--./hiding-->

                <th>
                  <ng-select
                    formControlName="usageId"
                    bindLabel="name"
                    (change)="
                      onFilterSelectionDrp('usageId', $event, page, itemsPerPage)
                    "
                  >
                    <ng-option *ngFor="let car of usageList" [value]="car.id">{{
                      car.name
                    }}</ng-option>
                  </ng-select>
                </th>

                <th>
                  <ng-select
                    formControlName="purposeId"
                    bindLabel="name"
                    (change)="
                      onFilterSelectionDrp('purposeId', $event, page, itemsPerPage)
                    "
                  >
                    <ng-option *ngFor="let car of purposeList" [value]="car.id">{{
                      car.name
                    }}</ng-option>
                  </ng-select>
                </th>

                <th>
                  <ng-select
                    formControlName="propertyTypeId"
                    bindLabel="name"
                    (change)="
                      onFilterSelectionDrp(
                        'propertyTypeId',
                        $event,
                        page,
                        itemsPerPage
                      )
                    "
                  >
                    <ng-option
                      *ngFor="let car of propertyTypeList"
                      [value]="car.id"
                      >{{ car.name }}</ng-option
                    >
                  </ng-select>
                </th>
                
                <th>
                  <ng-select
                    formControlName="bedsId"
                    bindLabel="name"
                    (change)="
                      onFilterSelectionDrp('bedsId', $event, page, itemsPerPage)
                    "
                  >
                    <ng-option *ngFor="let car of bedList" [value]="car.id">{{
                      car.name
                    }}</ng-option>
                  </ng-select>
                </th>

                <th>
                  <div class="d-flex gap-2 w-200px">
                    <input
                      placeholder="From"
                      formControlName="minBUA"
                      class="form-control mb-3 mb-lg-0"
                      mask="0*.00"
                      [dropSpecialCharacters]="false"
                      (keyup)="
                      onFilterSelectionDecimal('minBUA', $event, page, itemsPerPage)
                      "
                    />
                    <input
                      placeholder="To"
                      formControlName="maxBUA"
                      mask="0*.00"
                      [dropSpecialCharacters]="false"
                      class="form-control mb-3 mb-lg-0"
                      (keyup)="
                      onFilterSelectionDecimal('maxBUA', $event, page, itemsPerPage)
                      "
                    />
                  </div>
                </th>
                
                
                <!--Address-->
                <th>
                  <ng-select
                    formControlName="emiratesId"
                    bindLabel="name"
                    (change)="
                      onFilterSelectionDrp('emiratesId', $event, page, itemsPerPage)
                    "
                  >
                    <ng-option *ngFor="let car of emiratesList" [value]="car.id">{{
                      car.name
                    }}</ng-option>
                  </ng-select>
                </th>
                <th>
                  <ng-select
                    formControlName="locationId"
                    bindLabel="name"
                    (change)="
                      onFilterSelectionDrp('locationId', $event, page, itemsPerPage)
                    "
                  >
                    <ng-option *ngFor="let car of locationList" [value]="car.id">{{
                      car.name
                    }}</ng-option>
                  </ng-select>
                </th>
                <th>
                  <ng-select
                    formControlName="subLocationId"
                    (change)="
                      onFilterSelectionDrp(
                        'subLocationId',
                        $event,
                        page,
                        itemsPerPage
                      )
                    "
                  >
                    <ng-option *ngFor="let car of subLocationList" [value]="car.id">{{
                      car.name
                    }}</ng-option>
                  </ng-select>
                </th>
                
                <th>
                  <input
                    formControlName="unitNumber"
                    class="form-control mb-3 mb-lg-0"
                    (keyup)="
                    onFilterSelection1st('unitNumber', $event, page, itemsPerPage)
                    "
                  />
                </th>
              
                <th>
                  <div class="d-flex gap-2 w-200px">
                    <input
                      placeholder="From"
                      formControlName="minPrice"
                      class="form-control mb-3 mb-lg-0"
                      (keyup)="
                        onFilterSelectionDecimal(
                          'minPrice',
                          $event,
                          page,
                          itemsPerPage
                        )
                      "
                    />
                    <input
                      placeholder="To"
                      formControlName="maxPrice"
                      class="form-control mb-3 mb-lg-0"
                      (keyup)="
                        onFilterSelectionDecimal(
                          'maxPrice',
                          $event,
                          page,
                          itemsPerPage
                        )
                      "
                    />
                  </div>
                </th>
                
                <th>
                  <input
                    placeholder="Min. 3 chars"
                    formControlName="ownerFirstName"
                    type="text"
                    class="form-control mb-3 mb-lg-0"
                    (keyup)="
                      onFilterSelection('ownerFirstName', $event, page, itemsPerPage)
                    "
                  />
                </th>
                <th>
                  <input style="border-bottom: 1px solid #e1e3ea"
                    placeholder="Min. 3 chars"
                    formControlName="ownerLastName"
                    type="text"
                    class="form-control mb-3 mb-lg-0"
                    (keyup)="
                      onFilterSelection('ownerLastName', $event, page, itemsPerPage)
                    "
                  />
                </th>
                
              </thead>
              <!-- end::Table Filter -->
              <!-- begin::Table Body -->
              <tbody *ngIf="listingDetails.length > 0">
                <tr
                  *ngFor="
                    let data of listingDetails
                      | paginate
                        : {
                            id:'viewing_listingData',
                            itemsPerPage: itemsPerPage,
                            currentPage: page,
                            totalItems: totalRecord
                          }
                  " 
                >
                  <th class="w-40px align-middle">
                    <div
                      class="form-check form-check-sm form-check-custom form-check-solid p-0"
                    >
                    <input class="form-check-input cursor-pointer" type="radio" name="Contact" [checked]="selectedListingId == data?.id" value="{{ data.id }}"
                    (change)="onSelectListingId(data)" />
                    </div>
                  </th>
                  <th class="kt_activities_toggle align-middle" >{{ data.reference }}</th>
                  <th class="kt_activities_toggle align-middle" ><span [ngClass]="data.statusName == 'Draft'? 'text-blue':data.statusName == 'Published'?'text-green': 'text-orange'">{{ data.statusName }}</span></th>
                  <th class="kt_activities_toggle align-middle" ><div class="d-flex gap-2">
                    <ngx-avatar *ngIf="data?.profileImage == null || data?.profileImage == ''" size="26" class="avatar" [name]="data?.agentName"></ngx-avatar>
                <img *ngIf="data?.profileImage != null && data?.profileImage != ''" [src]="imgUrl + data?.profileImage" alt="Image Preview" [style.border-radius.px]="50" [style.width.px]="26" [style.height.px]="26">
                    <!-- <ngx-avatar size="26" class="avatar" [name]="data?.agentName"></ngx-avatar> -->
                    {{ data.agentName }}</div></th>
                  <!--Agent Email: hiding it for now-->
                  <!--./hiding it-->
                  <th class="kt_activities_toggle align-middle" >
                    {{ data.usageName }}
                  </th>
                  <th class="kt_activities_toggle align-middle" >
                    {{ data.purposeName }}
                  </th>
                  <th class="kt_activities_toggle align-middle" >
                    {{ data.propertytypeName }}
                  </th>
                  
                  <th class="kt_activities_toggle align-middle" >
                    {{ data.bedsName }}
                  </th>

                  <th class="kt_activities_toggle align-middle" >
                    {{ data.buildUpArea }}
                  </th>
                  
                  <th class="kt_activities_toggle align-middle" >
                    {{ data.emiratesName }}
                  </th>
                  <th class="kt_activities_toggle align-middle" >
                    {{ data.locationName }}
                  </th>
                  <th class="kt_activities_toggle align-middle" >
                    {{ data.subLocationName }}
                  </th>
                  
                  <th class="kt_activities_toggle align-middle" >
                    {{ data.unitNumber }}
                  </th>
                  
                  <th class="kt_activities_toggle align-middle" >
                    {{ data.price }}
                  </th>
                  
                  <th class="kt_activities_toggle align-middle" >
                    {{ data.ownerFirstname }}
                  </th>
                  <th class="kt_activities_toggle align-middle" >
                    {{ data.ownerLastname }}
                  </th>
                  
                </tr>
              </tbody>
              <!-- end::Table Body -->
            </table>
              <div
                class="text-center mt-5 mb-5"
                *ngIf="listingDetails && listingDetails?.length == 0"
              >
                Record not available
              </div>
              <!-- end::Table -->
            </div>
            <!-- end::Table container -->
          </div>
          <div class="modal-footer py-3">
            <div class="d-flex justify-content-between flex-column-reverse me-auto">
              <pagination-controls *ngIf="listingDetails.length > 0" (pageChange)="renderPage($event)" id="viewing_listingData"></pagination-controls>
              <span class="d-block mb-3">Showing {{ listingDetails.length }} of <b>{{ totalRecord }}</b> Listings</span>
            </div>

            <button class="btn btn-sm btn-light btn-active-light-primary me-3" (click)="closeListing()"> Cancel </button>
            <button
            (click)="saveListing()"
            [disabled]="tempSelectedListingRef == null"
            class="btn btn-sm btn-flex btn-primary fw-bold me-1"
            id=""
          >
            <i class="bi bi-right"></i> Apply
            </button>
          </div>
        </div>
    </form>
</ng-template>


  <ng-template #ViewLead>
    <form novalidate="" [formGroup]="ContactBasicForm" class="form">
        <div class="modal-content advance-filter-modal">
      
          <div class="modal-content">
            <div class="modal-header py-3">
              <!--begin::Modal title-->
              <h4 class="m-0">Select Lead</h4>
              <!--end::Modal title-->
              <div
                class="btn btn-sm btn-icon btn-active-color-primary"
                (click)="closeViewLead()"
              >
                <i class="ki-duotone ki-cross fs-1"
                  ><span class="path1"></span><span class="path2"></span
                ></i>
              </div>
            </div>
            <div class="modal-body p-0">
              <div class="table-responsive">
                <!-- begin::Table -->
                <table
                  id="listings_row"
                  class="table table-row-dashed table-row-gray-300 align-middle gs-0 gy-4"
                >
                  <!-- begin::Table head -->
                  <thead class="fw-bold">
                    <th class="w-40px">
                      <!-- <div
                        class="form-check form-check-sm form-check-custom form-check-solid p-0"
                      >
                        <input
                          class="form-check-input"
                          type="checkbox"
                          value="1"
                          data-kt-check="true"
                          data-kt-check-target=".widget-9-check"
                        />
                      </div> -->
                    </th>
                    <th
                    class="min-w-120px"
                    (click)="
                      leadData(
                        'Ref',
                        !ContactBasicForm.value.sortDirection,
                        leadpage,
                        leaditemsPerPage
                      )
                    "
                  >
                      Reference
                    </th>
                    <th
                      class="min-w-120px"
                      (click)="
                        leadData(
                          'Status',
                          !ContactBasicForm.value.sortDirection,
                          leadpage,
                          leaditemsPerPage
                        )
                      "
                    >
                    Status
                  </th>
                  <th
                    class="min-w-120px"
                    (click)="
                      leadData(
                        'SubStatus',
                        !ContactBasicForm.value.sortDirection,
                        leadpage,
                        leaditemsPerPage
                      )
                    "
                  >
                    Sub Status
                  </th>
        
                  <th
                      class="min-w-120px"
                      (click)="
                        leadData(
                          'Agent',
                          !ContactBasicForm.value.sortDirection,
                          leadpage,
                          leaditemsPerPage
                        )
                      "
                    >
                    Assigned To
                    </th>
                  
                    <th
                      class="min-w-120px"
                      (click)="
                        leadData(
                          'FirstName',
                          !ContactBasicForm.value.sortDirection,
                          leadpage,
                          leaditemsPerPage
                        )
                      "
                    >
                    First Name
                  </th>
                  <th
                    class="min-w-120px"
                    (click)="
                      leadData(
                        'LastName',
                        !ContactBasicForm.value.sortDirection,
                        leadpage,
                        leaditemsPerPage
                      )
                    "
                  >
                    Last Name
                  </th>
        
                  <th
              class="min-w-120px"
              (click)="
                leadData(
                  'PersonalMobile',
                  !ContactBasicForm.value.sortDirection,
                  leadpage,
                  leaditemsPerPage
                )
              "
                >
                
                Personal Mobile
              </th>
              <th
              class="min-w-120px"
              (click)="
                leadData(
                  'WorkMobile',
                  !ContactBasicForm.value.sortDirection,
                  leadpage,
                  leaditemsPerPage
                )
              "
                >
                Work Mobile
              </th>
              <th
              class="min-w-120px"
              (click)="
                leadData(
                  'OtherMobile',
                  !ContactBasicForm.value.sortDirection,
                  leadpage,
                  leaditemsPerPage
                )
              "
                >
                Other Mobile
              </th>
              <th
              class="min-w-120px"
              (click)="
                leadData(
                  'PersonalPhone',
                  !ContactBasicForm.value.sortDirection,
                  leadpage,
                  leaditemsPerPage
                )
              "
                >
                Personal Phone
              </th>
              <th
              class="min-w-120px"
              (click)="
                leadData(
                  'WorkPhone',
                  !ContactBasicForm.value.sortDirection,
                  leadpage,
                  leaditemsPerPage
                )
              "
                >
                Work Phone
              </th>
              <th
              class="min-w-120px"
              (click)="
                leadData(
                  'OtherPhone',
                  !ContactBasicForm.value.sortDirection,
                  leadpage,
                  leaditemsPerPage
                )
              "
                >
                Other Phone
              </th>
              <th
              class="min-w-120px"
              (click)="
                leadData(
                  'PersonalEmail',
                  !ContactBasicForm.value.sortDirection,
                  leadpage,
                  leaditemsPerPage
                )
              "
                >
                Personal Email
              </th>
              <th
              class="min-w-120px"
              (click)="
                leadData(
                  'WorkEmail',
                  !ContactBasicForm.value.sortDirection,
                  leadpage,
                  leaditemsPerPage
                )
              "
                >
                Work Email
              </th>
              <th
              class="min-w-120px"
              (click)="
                leadData(
                  'OtherEmail',
                  !ContactBasicForm.value.sortDirection,
                  leadpage,
                  leaditemsPerPage
                )
              "
                >
                Other Email
              </th>
                  
            <th
              class="min-w-120px"
              (click)="
                leadData(
                  'LeadType',
                  !ContactBasicForm.value.sortDirection,
                  leadpage,
                  leaditemsPerPage
                )
              "
              >
                  Lead Type
                    </th>
                    
                    
                    
                  </thead>
          
                  <!-- begin::Table Filter -->
                  <thead id="filter">
                    <th></th>
                    <th>
                        <input
                          class="form-control mb-3 mb-lg-0"
                          type="text"
                          placeholder="Min 3 chars"
                          formControlName="reference"
                          name="Reference"
                          style="min-width: 40px !important"
                          (keyup)="
                            onFilterLeadSelection('reference', $event, leadpage, leaditemsPerPage)
                          "
                        />
                    </th>
                        <th>
                        <ng-select
                          formControlName="statusId"
                          bindLabel="name"
                          (change)="
                            onFilterLeadSelectionDrp('statusId', $event, leadpage, leaditemsPerPage)
                          "
                        >
                          <ng-option
                            *ngFor="let status of AllStatusType"
                            [value]="status.id"
                            >{{ status.name }}</ng-option
                          >
                        </ng-select>
                    </th>
                    <th>
                        <ng-select
                          formControlName="subStatusId"
                          bindLabel="name"
                          (change)="
                            onFilterLeadSelectionDrp(
                              'subStatusId',
                              $event,
                              leadpage,
                              leaditemsPerPage
                            )
                          "
                        >
                          <ng-option
                            *ngFor="let sub of AllSubStatusType"
                            [value]="sub.id"
                            >{{ sub.name }}</ng-option
                          >
                        </ng-select>
                    </th>
        
                    <th>
                        <ng-select
                          formControlName="agentId"
                          bindLabel="Agent"
                          (change)="
                            onFilterLeadSelectionDrp('agentId', $event, leadpage, leaditemsPerPage)
                          "
                        >
                          <ng-option *ngFor="let s of AgentList" [value]="s.id">{{
                            s.name
                          }}</ng-option>
                        </ng-select>
                    </th>
                    
                    <th>
                        <input
                          class="form-control mb-3 mb-lg-0"
                          type="text"
                          placeholder="Min 3 chars"
                          formControlName="firstName"
                          name="Firstname"
                          style="min-width: 40px !important"
                          (keyup)="
                            onFilterLeadSelection('firstName', $event, leadpage, leaditemsPerPage)
                          "
                        />
                    </th>
                    <th>
                        <input
                          class="form-control mb-3 mb-lg-0"
                          type="text"
                          placeholder="Min 3 chars"
                          formControlName="lastName"
                          name="Lastname"
                          style="min-width: 40px !important"
                          (keyup)="
                            onFilterLeadSelection('lastName', $event, leadpage, leaditemsPerPage)
                          "
                        />
                    </th>
                    <th>
                        <input
                          class="form-control mb-3 mb-lg-0"
                          type="text"
                          placeholder="Min 3 chars"
                          formControlName="personalMobile"
                          name="personalMobile"
                          style="min-width: 40px !important"
                          (keyup)="
                            onFilterLeadSelection('personalMobile', $event, leadpage, leaditemsPerPage)
                          "
                        />
                    </th>
                    <th>
                        <input
                          class="form-control mb-3 mb-lg-0"
                          type="text"
                          placeholder="Min 3 chars"
                          formControlName="workMobile"
                          name="workMobile"
                          style="min-width: 40px !important"
                          (keyup)="
                            onFilterLeadSelection('workMobile', $event, leadpage, leaditemsPerPage)
                          "
                        />
                    </th>
                    <th>
                        <input
                          class="form-control mb-3 mb-lg-0"
                          type="text"
                          placeholder="Min 3 chars"
                          formControlName="otherMobile"
                          name="otherMobile"
                          style="min-width: 40px !important"
                          (keyup)="
                            onFilterLeadSelection('otherMobile', $event, leadpage, leaditemsPerPage)
                          "
                        />
                    </th>
                    <th>
                        <input
                          class="form-control mb-3 mb-lg-0"
                          type="text"
                          placeholder="Min 3 chars"
                          formControlName="personalPhone"
                          name="personalPhone"
                          style="min-width: 40px !important"
                          (keyup)="
                            onFilterLeadSelection('personalPhone', $event, leadpage, leaditemsPerPage)
                          "
                        />
                    </th>
                    <th>
                        <input
                          class="form-control mb-3 mb-lg-0"
                          type="text"
                          placeholder="Min 3 chars"
                          formControlName="workPhone"
                          name="workPhone"
                          style="min-width: 40px !important"
                          (keyup)="
                            onFilterLeadSelection('workPhone', $event, leadpage, leaditemsPerPage)
                          "
                        />
                    </th>
                    <th>
                        <input
                          class="form-control mb-3 mb-lg-0"
                          type="text"
                          placeholder="Min 3 chars"
                          formControlName="otherPhone"
                          name="otherPhone"
                          style="min-width: 40px !important"
                          (keyup)="
                            onFilterLeadSelection('otherPhone', $event, leadpage, leaditemsPerPage)
                          "
                        />
                    </th>
                    <th>
                        <input
                          class="form-control mb-3 mb-lg-0"
                          type="text"
                          placeholder="Min 3 chars"
                          formControlName="personalEmail"
                          name="personalEmail"
                          style="min-width: 40px !important"
                          (keyup)="
                            onFilterLeadSelection('personalEmail', $event, leadpage, leaditemsPerPage)
                          "
                        />
                    </th>
                    <th>
                        <input
                          class="form-control mb-3 mb-lg-0"
                          type="text"
                          placeholder="Min 3 chars"
                          formControlName="workEmail"
                          name="workEmail"
                          style="min-width: 40px !important"
                          (keyup)="
                            onFilterLeadSelection('workEmail', $event, leadpage, leaditemsPerPage)
                          "
                        />
                    </th>
                    <th>
                        <input
                          class="form-control mb-3 mb-lg-0"
                          type="text"
                          placeholder="Min 3 chars"
                          formControlName="otherEmail"
                          name="otherEmail"
                          style="min-width: 40px !important"
                          (keyup)="
                            onFilterLeadSelection('otherEmail', $event, leadpage, leaditemsPerPage)
                          "
                        />
                    </th>
               
                    
                    <th>
                        <ng-select
                          formControlName="leadTypeId"
                          bindLabel="name"
                          (change)="
                            onFilterLeadSelectionDrp('leadTypeId', $event, leadpage, leaditemsPerPage)
                          "
                        >
                          <ng-option
                            *ngFor="let type of LeadTypeList"
                            [value]="type.id"
                            >{{ type.name }}</ng-option
                          >
                        </ng-select>
                    </th>
                    
                   
                  
                   
                  </thead>
                  <!-- end::Table Filter -->
                  <tbody>
                    <tr
                      *ngFor="
                        let data of contactDetails
                          | paginate
                            : {
                                id:'viewing_contactDetail',
                                itemsPerPage: leaditemsPerPage,
                                currentPage: leadpage,
                                totalItems: totalItems
                              }
                      "
                    >
                      <th class="w-40px">
                        <div
                          class="form-check form-check-sm form-check-custom form-check-solid p-0"
                        >
                        <input class="form-check-input cursor-pointer" type="radio" name="Contact" [checked]="selectedLeadId == data?.id" value="{{ data.id }}"
                        (change)="onSelectLeadId(data)" />
                        </div>
                      </th>
                      <th class="kt_activities_toggle" >
                        {{ data?.reference }}
                      </th>
                      <th class="kt_activities_toggle align-middle" >
                        <span [ngClass]="data.statusName == 'Closed'? 'text-grey':data.statusName == 'Open'?'text-blue': ''">{{ data?.statusName }}</span>
                      </th>
                     
                      <th class="kt_activities_toggle" >
                        <span [ngClass]="data.subStatusName == 'In Progress'||
              data.subStatusName == 'Viewing Arranged'||
              data.subStatusName == 'Offer Made'||
              data.subStatusName == 'Interested'||
              data.subStatusName == 'Interested To Meet'||
              data.subStatusName == 'Viewing Done' ||
              data.subStatusName == 'Successful'
               ? 'text-green'
               :data.subStatusName == 'Budget Differs'||
               data.subStatusName == 'Not Interested'||
               data.subStatusName == 'Client not Reachable'||
               data.subStatusName == 'Incorrect Contact Details'||
               data.subStatusName == 'Invalid inquiry'||
               data.subStatusName == 'Price too High'||
               data.subStatusName == 'Unsuccessful'
               ?'text-red'
               : data.subStatusName == 'Not Yet Contacted'||
               data.subStatusName == 'Called No Reply'||
               data.subStatusName == 'Follow Up'||
               data.subStatusName == 'Client to revert'||
               data.subStatusName == 'Needs More Info'||
               data.subStatusName == 'Needs Time'||
               data.subStatusName == 'Look-see'||
               data.subStatusName == 'SMS sent to Agen'||
               data.subStatusName == 'Email sent to Agent'||
               data.subStatusName == 'Client Connected Online To Agent'
               ? 'text-blue' : ''">{{ data?.subStatusName }}</span>
                      </th>
                      <th class="kt_activities_toggle" >
                        <div class="d-flex gap-2">
                          <ngx-avatar *ngIf="data?.profileImage == null || data?.profileImage == ''" size="26" class="avatar" [name]="data?.agentName"></ngx-avatar>
                <img *ngIf="data?.profileImage != null && data?.profileImage != ''" [src]="imgUrl + data?.profileImage" alt="Image Preview" [style.border-radius.px]="50" [style.width.px]="26" [style.height.px]="26">
                          <!-- <ngx-avatar size="26" class="avatar" [name]="data?.agentName"></ngx-avatar> -->
                          {{ data.agentName }}</div>
                      </th>
                      <th class="kt_activities_toggle" >
                        {{ data?.firstName }}
                      </th>
                      <th class="kt_activities_toggle" >
                        {{ data?.lastName }}
                      </th>
                      <th class="kt_activities_toggle" >
                        {{getMobile(1,data?.leadMobile)}}
                      </th>
                      <th class="kt_activities_toggle" >
                        {{getMobile(2,data?.leadMobile)}}
                      </th>
                      <th class="kt_activities_toggle" >
                        {{getMobile(3,data?.leadMobile)}}
                      </th>
                      <th class="kt_activities_toggle" >
                        {{getPhone(1,data?.leadPhone)}}
                      </th>
                      <th class="kt_activities_toggle" >
                        {{getPhone(2,data?.leadPhone)}}
                      </th>
                      <th class="kt_activities_toggle" >
                        {{getPhone(3,data?.leadPhone)}}
                      </th>
                      <th class="kt_activities_toggle" >
                        {{getEmail(1,data?.leadEmail)}}
                      </th>
                      <th class="kt_activities_toggle" >
                        {{getEmail(2,data?.leadEmail)}}
                      </th>
                      <th class="kt_activities_toggle" >
                        {{getEmail(3,data?.leadEmail)}}
                      </th>
                     
                      <th class="kt_activities_toggle" >
                        {{ data?.leadTypeName }}
                      </th>
                      
                     
                      
                    </tr>
                  </tbody>
                  <!-- end::Table Body -->
                </table>
          
                <div
                  class="text-center mt-5 mb-5"
                  *ngIf="contactDetails && contactDetails?.length === 0"
                >
                  Record not available
                </div>
                <!-- end::Table -->
                
              </div>
            </div>
      
            <div class="modal-footer py-3">
              <!--Pagination-->
              <div class="d-flex justify-content-between flex-column-reverse me-auto">
                <pagination-controls *ngIf="contactDetails.length > 0" (pageChange)="renderleadPage($event)" id="viewing_contactDetail"></pagination-controls>
                <span class="d-block mb-3">Showing {{ contactDetails.length }} of <b>{{ totalItems }}</b> Leads</span>
              </div>
              <!--./Pagination-->
              <button class="btn btn-sm btn-light btn-active-light-primary me-3" (click)="closeLead()"> Cancel </button>
              <button
              (click)="saveLead()"
              [disabled]="tempSelectedLeadRef == null"
              class="btn btn-sm btn-flex btn-primary fw-bold me-1"
              id=""
            >
              <i class="bi bi-right"></i> Apply
              </button>
            </div>
          </div>
        </div>
    </form>
  </ng-template>